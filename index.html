<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#000000">
<title>Oquefazer</title>

<link rel="preload" as="image" href="fundo.jpg">
<link rel="icon" href="icone.png">
<link rel="apple-touch-icon" href="icone.png">
<link rel="manifest" href="manifest.json">

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  background: url('fundo.jpg') center/cover no-repeat;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  height: 100vh;
  padding-bottom: 6.5vh;
  box-sizing: border-box;
  overflow-y: auto;
}

.container {
  background: rgba(255,255,255,0.92);
  padding: 16px 28px;
  border-radius: 25px;
  box-shadow: 0 25px 60px rgba(0,0,0,0.25);
  width: 90%;
  max-width: 420px;
  text-align: center;
  backdrop-filter: blur(6px);
  transition: opacity 0.3s ease;
}

.container.loading {
  opacity: 0.6;
  pointer-events: none;
}

h3 {
  margin-bottom: 12px;
  font-size: 22px;
  color: #333;
}

.input-wrapper {
  position: relative;
  margin-bottom: 0;
}

input {
  width: 100%;
  padding: 10px;
  padding-right: 46px;
  border-radius: 14px;
  border: 1px solid #ddd;
  font-size: 16px;
  outline: none;
  box-sizing: border-box;
  transition: 0.2s;
}

input:focus {
  border-color: #6eb233;
  box-shadow: 0 0 0 3px rgba(110,179,51,0.2);
}

.geo-btn {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
}

button {
  width: 100%;
  padding: 13px;
  border: none;
  border-radius: 14px;
  font-size: 15px;
  font-weight: bold;
  cursor: pointer;
  background: #6eb233;
  color: white;
  transition: all 0.2s ease;
}

button:active {
  transform: scale(0.97);
}

.btn-group {
  display: flex;
  gap: 8px;
  margin-top: 8px;
}

.btn-group button {
  font-size: 13px;
  padding: 8px;
}

.cat-group {
  display: flex;
  gap: 6px;
  margin: 10px 0;
}

.cat-btn {
  flex: 1;
  font-size: 12px;
  padding: 6px 2px;
  background: white;
  color: #6eb233;
  border: 1.5px solid #6eb233;
  border-radius: 14px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s ease;
}

.cat-btn.ativo {
  background: #6eb233;
  color: white;
}

.cidade-row {
  display: flex;
  gap: 8px;
  margin-bottom: 10px;
  align-items: center;
}

.cidade-row .input-wrapper {
  flex: 1;
}

.evento-btn {
  width: auto;
  padding: 10px 12px;
  font-size: 13px;
  background: white;
  color: #6eb233;
  border: 1.5px solid #6eb233;
}

.evento-btn.ativo {
  background: #6eb233;
  color: white;
}

.evento-wrapper {
  margin-bottom: 10px;
  display: none;
}

#splash {
  position: fixed;
  inset: 0;
  background: #000;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity 0.5s ease;
}
</style>
</head>

<body>

<div id="splash">
  <img src="splash.png" style="width:260px;">
</div>

<div class="container">
<h3>Eventos perto de voc√™</h3>

<div class="cidade-row">
  <div class="input-wrapper">
    <input type="text" id="cidade">
    <button type="button" class="geo-btn" onclick="detectarCidade()">üìç</button>
  </div>
  <button type="button" class="evento-btn" onclick="toggleEvento()">üé´ Evento</button>
</div>

<div class="evento-wrapper" id="eventoWrapper">
  <input type="text" id="evento" placeholder="Nome do evento ou artista">
</div>

<div class="cat-group">
  <button type="button" class="cat-btn" onclick="toggleCategoria(this,'Bares')">üçª Bares</button>
  <button type="button" class="cat-btn" onclick="toggleCategoria(this,'Shows')">üé∂ Shows</button>
  <button type="button" class="cat-btn" onclick="toggleCategoria(this,'Cultura')">üé≠ Cultura</button>
</div>

<div class="cat-group">
  <button type="button" class="cat-btn" onclick="toggleCategoria(this,'Natureza')">üå± Natureza</button>
  <button type="button" class="cat-btn" onclick="toggleCategoria(this,'Esporte')">üéæ Esporte</button>
  <button type="button" class="cat-btn" onclick="toggleCategoria(this,'Feiras')">üõçÔ∏è Feiras</button>
</div>

<div class="btn-group">
  <button type="button" onclick="buscar('hoje')">Hoje</button>
  <button type="button" onclick="buscar('fimdesemana')">Fim de semana</button>
  <button type="button" onclick="buscar('7dias')">7 dias</button>
</div>

<p style="margin-top:12px;font-size:13px;color:#555;">
Escolha categoria e per√≠odo, ou busque evento espec√≠fico
</p>

</div>

<script>
let categoriaSelecionada = '';

function toggleEvento() {
  const cats = document.querySelectorAll('.cat-btn');
  const wrapper = document.getElementById('eventoWrapper');
  const btn = document.querySelector('.evento-btn');

  if (wrapper.style.display === 'none' || wrapper.style.display === '') {
    wrapper.style.display = 'block';
    btn.classList.add('ativo');
    document.getElementById('evento').focus();

    cats.forEach(b => {
      b.classList.remove('ativo');
      b.disabled = true;
      b.style.opacity = '0.4';
    });

    categoriaSelecionada = '';
  } else {
    wrapper.style.display = 'none';
    btn.classList.remove('ativo');
    document.getElementById('evento').value = '';

    cats.forEach(b => {
      b.disabled = false;
      b.style.opacity = '1';
    });
  }
}

function toggleCategoria(btn, categoria) {
  const todos = document.querySelectorAll('.cat-btn');

  if (categoriaSelecionada === categoria) {
    btn.classList.remove('ativo');
    categoriaSelecionada = '';
  } else {
    todos.forEach(b => b.classList.remove('ativo'));
    btn.classList.add('ativo');
    categoriaSelecionada = categoria;
  }
}

function buscar(periodo) {
  const cidade = document.getElementById("cidade").value.trim();
  if (!cidade) {
    alert("Digite uma cidade");
    return;
  }

  document.querySelector('.container').classList.add('loading');

  let tempo =
    periodo === 'hoje'
      ? 'hoje'
      : periodo === 'fimdesemana'
      ? 'neste fim de semana (sexta, s√°bado e domingo)'
      : 'nos pr√≥ximos 7 dias a partir de hoje';

  const eventoEspecifico = document.getElementById('evento').value.trim();
  let query;

  if (eventoEspecifico) {
    query = `Buscar APENAS informa√ß√µes sobre ${eventoEspecifico} em ${cidade} ${tempo}. Mostrar somente este evento. Informar data, hor√°rio, local e links oficiais. Se n√£o houver confirma√ß√£o, informar claramente.`;
  } else {
    const filtroCategoria = categoriaSelecionada
      ? ` Mostrar apenas eventos da categoria ${categoriaSelecionada}.`
      : '';

    query = `Todos os eventos reais em ${cidade} ${tempo}, em ordem cronol√≥gica. N√£o invente eventos. Mostrar data, hor√°rio, local e link.${filtroCategoria}`;
  }

  const url = "https://www.google.com/search?udm=50&hl=pt-BR&q=" + encodeURIComponent(query);

  setTimeout(() => {
    window.location.href = url;
  }, 700);
}

function detectarCidade() {
  if (!navigator.geolocation) return;

  const btn = document.querySelector('.geo-btn');
  btn.textContent = '‚è≥';

  navigator.geolocation.getCurrentPosition(async (pos) => {
    const { latitude, longitude } = pos.coords;
    try {
      const res = await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${latitude}&lon=${longitude}&format=json`);
      const data = await res.json();
      const cidade = data.address.city || data.address.town || data.address.village;
      if (cidade) {
        document.getElementById('cidade').value = cidade;
      }
    } catch(e) {}

    btn.textContent = 'üìç';
  }, () => {
    btn.textContent = 'üìç';
  });
}

window.addEventListener('load', () => {
  setTimeout(() => {
    const splash = document.getElementById('splash');
    splash.style.opacity = '0';
    setTimeout(() => splash.remove(), 500);
  }, 1500);
});

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/oquefazer/sw.js');
}
</script>

</body>
</html>
